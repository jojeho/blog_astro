---
import Layout from '../../layouts/Layout.astro';

interface Frontmatter {
  tags?: string[],
  title:string
}

interface  Post{
    url:string;
    frontmatter:Frontmatter,
    
}

export async function getStaticPaths() {
    const allPosts:any=await Astro.glob('../posts/*.md');
    const uniqueTags= [...new Set(allPosts.map((post:Post) => post.frontmatter.tags).flat() as string)];
    return uniqueTags.map((tag )=>{
        const p =allPosts.filter((post:Post)=>post.frontmatter.tags?.includes(tag));
        return {
            params:{tag},
            props:{posts:p},
        };
    })
}

const { tag } = Astro.params;
const { posts} = Astro.props;

---
<Layout title={tag}>
  <p>Posts tagged with {tag}</p>
  <ul>
    {posts.map((post:Post)=><li><a href={post.url}>{post.frontmatter.title}</a></li>)}
  </ul>
</Layout>